var C=Object.defineProperty;var P=(t,e,s)=>e in t?C(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var c=(t,e,s)=>(P(t,typeof e!="symbol"?e+"":e,s),s);import{c as y,g as S,t as F,w as H,r as i,j as n,B as b,a as $,C as q,u as z,b as L,s as B,d as D,i as G,e as I,h as R,f as N,k as W,I as J,M as O}from"./index.9642abf5.js";/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k=y("FileDown",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["path",{d:"M12 18v-6",key:"17g6i2"}],["path",{d:"m9 15 3 3 3-3",key:"1npd3o"}]]);/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T=y("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);const A=`${H}/generation/create`;class Q{constructor(){c(this,"processing");c(this,"connection");c(this,"message");c(this,"onProcessingChange");c(this,"onMessage");c(this,"onError");c(this,"onFinished");this.processing=!1,this.connection=null,this.message=""}setProcessingChangeHandler(e){this.onProcessingChange=e}setMessageHandler(e){this.onMessage=e}setErrorHandler(e){this.onError=e}setFinishedHandler(e){this.onFinished=e}isProcessing(){return this.processing}setProcessing(e){var s;return this.processing=e,e||(this.connection=null,this.message=""),(s=this.onProcessingChange)==null||s.call(this,e),e}getConnection(){return this.connection}handleMessage(e){var s,o,r;if(e.error&&e.end){(s=this.onError)==null||s.call(this,e.error),this.setProcessing(!1);return}this.message+=e.message,(o=this.onMessage)==null||o.call(this,{message:this.message,quota:e.quota}),e.end&&((r=this.onFinished)==null||r.call(this,e.hash),this.setProcessing(!1))}generate(e,s){this.setProcessing(!0);const o=S(F)||"anonymous";o&&(this.connection=new WebSocket(A),this.connection.onopen=()=>{var r;(r=this.connection)==null||r.send(JSON.stringify({token:o,prompt:e,model:s}))},this.connection.onmessage=r=>{this.handleMessage(JSON.parse(r.data))},this.connection.onclose=()=>{this.setProcessing(!1)})}generateWithBlock(e,s){return this.isProcessing()?!1:(this.generate(e,s),!0)}}const d=new Q;function V({onSend:t}){const{t:e}=z(),s=i.useRef(null),[o,r]=i.useState(!1),[g,u]=i.useState(""),[E,m]=i.useState(""),[p,f]=i.useState(0),h=L(B),x=i.useRef(h),{toast:j}=D();function M(){m(""),f(0),u("")}d.setMessageHandler(({message:a,quota:l})=>{m(a),f(l)}),d.setErrorHandler(a=>{j({title:e("generate.failed"),description:`${e("generate.reason")} ${a}`})}),d.setFinishedHandler(a=>{j({title:e("generate.success"),description:e("generate.success-prompt")}),u(a)});function v(a="gpt-3.5-16k"){const l=s.current;if(!l)return;const w=l.value.trim();w.length&&t!=null&&t(w,a)&&(r(!0),M(),l.value="")}return i.useEffect(()=>{const a=s.current;if(a)return a.focus(),a.removeEventListener("keydown",()=>{}),a.addEventListener("keydown",l=>{G(l)&&v(x.current)}),()=>{s.current&&s.current.removeEventListener("keydown",()=>{})}},[s]),i.useEffect(()=>{x.current=h},[h]),n.jsxs("div",{className:"generation-wrapper",children:[o?n.jsxs("div",{className:"box",children:[p>0&&n.jsxs("div",{className:"quota-box",children:[n.jsx(I,{className:"h-4 w-4 mr-2"}),p.toFixed(2)]}),n.jsx("pre",{className:"message-box",children:R(E)||e("generate.empty")}),g.length>0&&n.jsxs("div",{className:"hash-box",children:[n.jsxs("a",{className:"download-box",href:`${N}/generation/download/tar?hash=${g}`,children:[n.jsx(k,{className:"h-6 w-6"}),n.jsx("p",{children:e("generate.download",{name:"tar.gz"})})]}),n.jsxs("a",{className:"download-box",href:`${N}/generation/download/zip?hash=${g}`,children:[n.jsx(k,{className:"h-6 w-6"}),n.jsx("p",{children:e("generate.download",{name:"zip"})})]})]})]}):n.jsxs("div",{className:"product",children:[n.jsx("img",{src:W,alt:""}),"AI Code Generator"]}),n.jsxs("div",{className:"generate-box",children:[n.jsx(J,{className:"input",ref:s,placeholder:e("generate.input-placeholder")}),n.jsx(b,{size:"icon",className:"action",variant:"default",onClick:()=>v(h),children:n.jsx(T,{className:"h-5 w-5"})})]}),n.jsx("div",{className:"model-box",children:n.jsx(O,{side:"bottom"})})]})}function U(){const[t,e]=i.useState(!1);return d.setProcessingChangeHandler(e),n.jsx("div",{className:"generation-page",children:n.jsxs("div",{className:"generation-container",children:[n.jsx(b,{className:"action",variant:"ghost",size:"icon",onClick:()=>$.navigate("/"),disabled:t,children:n.jsx(q,{className:"h-5 w-5 back"})}),n.jsx(V,{onSend:(s,o)=>(console.debug(`[generation] create generation request (prompt: ${s}, model: ${o})`),d.generateWithBlock(s,o))})]})})}export{U as default};
