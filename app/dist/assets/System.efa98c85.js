import{aM as M,aN as D,u as f,d as E,r as g,bB as H,m as G,j as e,J,K as Q,O as U,P as K,B as m,aQ as X,n as z,W as r,I as d,bC as Y,bD as Z,aJ as x,b8 as y,b7 as v,bz as w,aX as $,bE as L,aY as W,aZ as F,bF as V,a$ as I,b0 as O,bA as S,b as ee,bG as se,bH as q,bh as P,bI as ae,bn as ne}from"./index.9642abf5.js";import{P as k,a as l,b as C,c as b,d as _}from"./Paragraph.93a128db.js";import{M as N}from"./multi-combobox.fd736ff8.js";import{a as te}from"./hook.09114b1f.js";import{S as le}from"./save.4c791d10.js";import{S as R}from"./settings-2.2a3c9014.js";import"./command.6605a855.js";import"./popover.305b8e8e.js";import"./chevrons-up-down.562b365d.js";async function ie(){try{const t=(await M.get("/admin/config/view")).data;return t.status&&t.data&&(t.data.mail.white_list.white_list=t.data.mail.white_list.white_list||A),t}catch(a){return{status:!1,error:D(a)}}}async function re(a){try{return(await M.post("/admin/config/update",a)).data}catch(t){return{status:!1,error:D(t)}}}async function oe(a){try{return(await M.post("/admin/user/root",{password:a})).data}catch(t){return{status:!1,error:D(t)}}}const A=["gmail.com","outlook.com","yahoo.com","hotmail.com","foxmail.com","icloud.com","qq.com","163.com","126.com"],ce={general:{logo:"",title:"",description:"",backend:"",docs:"",file:"",pwa_manifest:"",debug_mode:!1},site:{close_register:!1,close_relay:!1,relay_plan:!1,quota:0,buy_link:"",announcement:"",contact:"",footer:"",auth_footer:!1},mail:{host:"",port:465,username:"",password:"",from:"",white_list:{enabled:!1,custom:"",white_list:[]}},search:{endpoint:"https://duckduckgo-api.vercel.app",query:5},common:{article:[],generation:[],cache:[],expire:3600,size:1,image_store:!1}};function me(){const{t:a}=f(),{toast:t}=E(),[i,s]=g.useState(!1),[n,u]=g.useState(""),[h,o]=g.useState(""),j=async()=>{const p=await oe(n);P(t,a,p,!0),p.status&&(u(""),o(""),s(!1),setTimeout(()=>{window.location.reload()},1e3))};return e.jsxs($,{open:i,onOpenChange:s,children:[e.jsx(L,{asChild:!0,children:e.jsx(m,{variant:"outline",size:"sm",children:a("admin.system.updateRoot")})}),e.jsxs(W,{children:[e.jsxs(F,{children:[e.jsx(V,{children:a("admin.system.updateRoot")}),e.jsxs(I,{children:[e.jsx("div",{className:"mb-4 select-none",children:a("admin.system.updateRootTip")}),e.jsx(d,{className:"mb-2",type:"password",placeholder:a("admin.system.updateRootPlaceholder"),value:n,onChange:p=>u(p.target.value)}),e.jsx(d,{type:"password",placeholder:a("admin.system.updateRootRepeatPlaceholder"),value:h,onChange:p=>o(p.target.value)})]})]}),e.jsxs(O,{children:[e.jsx(m,{variant:"outline",onClick:()=>{u(""),o(""),s(!1)},children:a("admin.cancel")}),e.jsx(m,{variant:"default",loading:!0,onClick:j,disabled:n.trim().length===0||n.trim()!==h.trim(),children:a("admin.confirm")})]})]})]})}function de({data:a,dispatch:t,onChange:i}){const{t:s}=f();return e.jsxs(k,{title:s("admin.system.general"),configParagraph:!0,isCollapsed:!0,children:[e.jsxs(l,{children:[e.jsx(r,{children:s("admin.system.title")}),e.jsx(d,{value:a.title,onChange:n=>t({type:"update:general.title",value:n.target.value}),placeholder:s("admin.system.titleTip")})]}),e.jsxs(l,{children:[e.jsx(r,{children:s("admin.system.description")}),e.jsx(d,{value:a.description,onChange:n=>t({type:"update:general.description",value:n.target.value}),placeholder:s("admin.system.descriptionTip")})]}),e.jsxs(l,{children:[e.jsx(r,{children:s("admin.system.docs")}),e.jsx(d,{value:a.docs,onChange:n=>t({type:"update:general.docs",value:n.target.value}),placeholder:s("admin.system.docsTip")})]}),e.jsxs(l,{children:[e.jsx(r,{children:s("admin.system.logo")}),e.jsx(d,{value:a.logo,onChange:n=>t({type:"update:general.logo",value:n.target.value}),placeholder:s("admin.system.logoTip",{logo:`${window.location.protocol}//${window.location.host}/favicon.ico`})})]}),e.jsxs(l,{children:[e.jsx(r,{children:s("admin.system.backend")}),e.jsx(d,{value:a.backend,onChange:n=>t({type:"update:general.backend",value:n.target.value}),placeholder:s("admin.system.backendPlaceholder")})]}),e.jsx(C,{border:!0,children:s("admin.system.backendTip",{backend:`${window.location.protocol}//${window.location.host}/api`})}),e.jsxs(l,{children:[e.jsx(r,{children:s("admin.system.file")}),e.jsx(d,{value:a.file,onChange:n=>t({type:"update:general.file",value:n.target.value}),placeholder:s("admin.system.filePlaceholder")})]}),e.jsx(C,{border:!0,children:s("admin.system.fileTip")}),e.jsxs(l,{children:[e.jsx(r,{children:"PWA Manifest"}),e.jsx(Y,{value:a.pwa_manifest??"",onChange:n=>t({type:"update:general.pwa_manifest",value:n}),children:e.jsxs(m,{variant:"outline",children:[e.jsx(Z,{className:"h-4 w-4 mr-1"}),s("edit")]})})]}),e.jsxs(l,{children:[e.jsxs(r,{children:[s("admin.system.debugMode"),e.jsx(x,{className:"inline-block",content:s("admin.system.debugModeTip")})]}),e.jsx(y,{checked:a.debug_mode,onCheckedChange:n=>{t({type:"update:general.debug_mode",value:n})}})]}),e.jsx(b,{}),e.jsxs(_,{children:[e.jsx("div",{className:"grow"}),e.jsx(me,{}),e.jsx(m,{size:"sm",loading:!0,onClick:async()=>await i(),children:s("admin.system.save")})]})]})}function he({data:a,dispatch:t,onChange:i}){const{t:s}=f(),[n,u]=g.useState(""),[h,o]=g.useState(!1),j=g.useMemo(()=>a.host.length>0&&a.port>0&&a.port<65535&&a.username.length>0&&a.password.length>0&&a.from.length>0&&/\w+@\w+\.\w+/.test(a.from)&&!a.username.includes("@"),[a]),p=async()=>{if(!n.trim())return;await i(!1);const c=await ae(n);P(ne,s,c,!0),c.status&&o(!1)},B=g.useMemo(()=>{const c=a.white_list.custom.split(",").map(T=>T.trim()).filter(T=>T.length>0);return[...A,...c]},[a]);return e.jsxs(k,{title:s("admin.system.mail"),configParagraph:!0,isCollapsed:!0,children:[!j&&e.jsx(C,{border:!0,children:s("admin.system.mailConfNotValid")}),e.jsxs(l,{children:[e.jsxs(r,{children:[e.jsx(v,{})," ",s("admin.system.mailHost")]}),e.jsx(d,{value:a.host,onChange:c=>t({type:"update:mail.host",value:c.target.value}),placeholder:"smtp.qcloudmail.com"})]}),e.jsxs(l,{children:[e.jsxs(r,{children:[e.jsx(v,{})," ",s("admin.system.mailPort")]}),e.jsx(w,{value:a.port,onValueChange:c=>t({type:"update:mail.port",value:c}),placeholder:"465",min:0,max:65535})]}),e.jsxs(l,{children:[e.jsxs(r,{children:[e.jsx(v,{})," ",s("admin.system.mailUser")]}),e.jsx(d,{value:a.username,onChange:c=>t({type:"update:mail.username",value:c.target.value}),className:z("transition-all duration-300",a.username.includes("@")&&"border-red-700"),placeholder:s("admin.system.mailUser")})]}),e.jsxs(l,{children:[e.jsxs(r,{children:[e.jsx(v,{})," ",s("admin.system.mailPass")]}),e.jsx(d,{value:a.password,onChange:c=>t({type:"update:mail.password",value:c.target.value}),placeholder:s("admin.system.mailPass")})]}),e.jsxs(l,{children:[e.jsxs(r,{children:[e.jsx(v,{})," ",s("admin.system.mailFrom")]}),e.jsx(d,{value:a.from,onChange:c=>t({type:"update:mail.from",value:c.target.value}),placeholder:`${a.username}@${location.hostname}`,className:z("transition-all duration-300",a.from.length>0&&!/\w+@\w+\.\w+/.test(a.from)&&"border-red-700")})]}),e.jsx(b,{}),e.jsxs(l,{children:[e.jsx(r,{children:s("admin.system.mailEnableWhitelist")}),e.jsx(y,{checked:a.white_list.enabled,onCheckedChange:c=>{t({type:"update:mail.white_list.enabled",value:c})}})]}),e.jsxs(l,{children:[e.jsx(r,{children:s("admin.system.mailWhitelist")}),e.jsx(N,{value:a.white_list.white_list,list:B,disabled:!a.white_list.enabled,onChange:c=>{t({type:"update:mail.white_list.white_list",value:c})},placeholder:s("admin.system.mailWhitelistSelected",{length:a.white_list.white_list.length}),searchPlaceholder:s("admin.system.mailWhitelistSearchPlaceholder")})]}),e.jsx(d,{className:"mb-2",value:a.white_list.custom,onChange:c=>t({type:"update:mail.white_list.custom",value:c.target.value}),disabled:!a.white_list.enabled,placeholder:s("admin.system.customWhitelistPlaceholder")}),e.jsxs(_,{children:[e.jsx("div",{className:"grow"}),e.jsxs($,{open:h,onOpenChange:o,children:[e.jsx(L,{asChild:!0,children:e.jsx(m,{variant:"outline",size:"sm",children:s("admin.system.test")})}),e.jsxs(W,{children:[e.jsxs(F,{children:[e.jsx(V,{children:s("admin.system.test")}),e.jsx(I,{className:"pt-2",children:e.jsx(d,{placeholder:s("auth.email-placeholder"),value:n,onChange:c=>u(c.target.value)})})]}),e.jsxs(O,{children:[e.jsx(m,{variant:"outline",onClick:()=>{u(""),o(!1)},children:s("admin.cancel")}),e.jsx(m,{variant:"default",loading:!0,onClick:p,children:s("admin.confirm")})]})]})]}),e.jsx(m,{size:"sm",loading:!0,onClick:async()=>await i(),children:s("admin.system.save")})]})]})}function ue({data:a,dispatch:t,onChange:i}){const{t:s}=f();return e.jsxs(k,{title:s("admin.system.site"),configParagraph:!0,isCollapsed:!0,children:[e.jsxs(l,{children:[e.jsxs(r,{children:[s("admin.system.closeRegistration"),e.jsx(x,{className:"inline-block",content:s("admin.system.closeRegistrationTip")})]}),e.jsx(y,{checked:a.close_register,onCheckedChange:n=>{t({type:"update:site.close_register",value:n})}})]}),e.jsxs(l,{children:[e.jsxs(r,{children:[s("admin.system.closeRelay"),e.jsx(x,{className:"inline-block",content:s("admin.system.closeRelayTip")})]}),e.jsx(y,{checked:a.close_relay,onCheckedChange:n=>{t({type:"update:site.close_relay",value:n})}})]}),e.jsxs(l,{children:[e.jsxs(r,{children:[s("admin.system.relayPlan"),e.jsx(x,{className:"inline-block",content:s("admin.system.relayPlanTip")})]}),e.jsx(y,{checked:a.relay_plan,onCheckedChange:n=>{t({type:"update:site.relay_plan",value:n})}})]}),e.jsxs(l,{children:[e.jsxs(r,{className:"flex flex-row items-center",children:[s("admin.system.quota"),e.jsx(x,{content:s("admin.system.quotaTip")})]}),e.jsx(w,{value:a.quota,onValueChange:n=>t({type:"update:site.quota",value:n}),placeholder:"5",min:0})]}),e.jsxs(l,{children:[e.jsx(r,{children:s("admin.system.buyLink")}),e.jsx(d,{value:a.buy_link,onChange:n=>t({type:"update:site.buy_link",value:n.target.value}),placeholder:s("admin.system.buyLinkPlaceholder")})]}),e.jsxs(l,{rowLayout:!0,children:[e.jsx(r,{children:s("admin.system.announcement")}),e.jsx(S,{value:a.announcement,rows:12,onChange:n=>t({type:"update:site.announcement",value:n.target.value}),placeholder:s("admin.system.announcementPlaceholder")})]}),e.jsxs(l,{rowLayout:!0,children:[e.jsx(r,{children:s("admin.system.contact")}),e.jsx(S,{value:a.contact,rows:6,onChange:n=>t({type:"update:site.contact",value:n.target.value}),placeholder:s("admin.system.contactPlaceholder")})]}),e.jsx(b,{}),e.jsxs(l,{rowLayout:!0,children:[e.jsx(r,{children:s("admin.system.footer")}),e.jsx(S,{rows:6,value:a.footer,onChange:n=>t({type:"update:site.footer",value:n.target.value}),placeholder:s("admin.system.footerPlaceholder")})]}),e.jsxs(l,{children:[e.jsx(r,{children:s("admin.system.authFooter")}),e.jsx(y,{checked:a.auth_footer,onCheckedChange:n=>{t({type:"update:site.auth_footer",value:n})}})]}),e.jsxs(_,{children:[e.jsx("div",{className:"grow"}),e.jsx(m,{size:"sm",loading:!0,onClick:async()=>await i(),children:s("admin.system.save")})]})]})}function xe({form:a,data:t,dispatch:i,onChange:s}){const{t:n}=f(),{channelModels:u}=te(),h=ee(se);return e.jsxs(k,{title:n("admin.system.common"),configParagraph:!0,isCollapsed:!0,children:[e.jsxs(l,{children:[e.jsxs(r,{className:"flex flex-row items-center",children:[n("admin.system.image_store"),e.jsx(x,{content:n("admin.system.image_storeTip")})]}),e.jsx(y,{checked:t.image_store,onCheckedChange:o=>{i({type:"update:common.image_store",value:o})}})]}),t.image_store&&a.general.backend.length===0&&e.jsx(C,{border:!0,children:n("admin.system.image_storeNoBackend")}),e.jsx(b,{}),e.jsxs(l,{children:[e.jsxs(r,{className:"flex flex-row items-center",children:[n("admin.system.cache"),e.jsx(x,{content:n("admin.system.cacheTip")})]}),e.jsx(N,{value:t.cache,onChange:o=>{i({type:"update:common.cache",value:o})},list:u,placeholder:n("admin.system.cachePlaceholder",{length:(t.cache??[]).length})})]}),e.jsxs(l,{children:[e.jsxs(r,{children:[n("admin.system.cacheExpired"),e.jsx(x,{className:"inline-block",content:n("admin.system.cacheExpiredTip")})]}),e.jsx(w,{value:t.expire,onValueChange:o=>i({type:"update:common.expire",value:o}),min:0})]}),e.jsxs(l,{children:[e.jsxs(r,{children:[n("admin.system.cacheSize"),e.jsx(x,{className:"inline-block",content:n("admin.system.cacheSizeTip")})]}),e.jsx(w,{value:t.size,onValueChange:o=>i({type:"update:common.size",value:o}),min:0})]}),e.jsx(l,{children:e.jsxs("div",{className:"flex flex-row flex-wrap gap-2 ml-auto",children:[e.jsxs(m,{variant:"outline",onClick:()=>i({type:"update:common.cache",value:[]}),children:[e.jsx(R,{className:"inline-flex h-4 w-4 mr-2 translate-y-[1px]"}),n("admin.system.cacheNone")]}),e.jsxs(m,{variant:"outline",onClick:()=>i({type:"update:common.cache",value:h.filter(o=>o.free).map(o=>o.id)}),children:[e.jsx(R,{className:"inline-flex h-4 w-4 mr-2 translate-y-[1px]"}),n("admin.system.cacheFree")]}),e.jsxs(m,{variant:"outline",onClick:()=>i({type:"update:common.cache",value:u}),children:[e.jsx(R,{className:"inline-flex h-4 w-4 mr-2 translate-y-[1px]"}),n("admin.system.cacheAll")]})]})}),e.jsx(b,{}),e.jsxs(l,{children:[e.jsxs(r,{className:"flex flex-row items-center",children:[n("admin.system.article"),e.jsx(x,{content:n("admin.system.articleTip")})]}),e.jsx(N,{value:t.article,onChange:o=>{i({type:"update:common.article",value:o})},list:q,listTranslate:"admin.channels.groups",placeholder:n("admin.system.groupPlaceholder",{length:(t.article??[]).length})})]}),e.jsxs(l,{children:[e.jsxs(r,{className:"flex flex-row items-center",children:[n("admin.system.generate"),e.jsx(x,{content:n("admin.system.generateTip")})]}),e.jsx(N,{value:t.generation,onChange:o=>{i({type:"update:common.generation",value:o})},list:q,listTranslate:"admin.channels.groups",placeholder:n("admin.system.groupPlaceholder",{length:(t.generation??[]).length})})]}),e.jsxs(_,{children:[e.jsx("div",{className:"grow"}),e.jsx(m,{size:"sm",loading:!0,onClick:async()=>await s(),children:n("admin.system.save")})]})]})}function pe({data:a,dispatch:t,onChange:i}){const{t:s}=f();return e.jsxs(k,{title:s("admin.system.search"),configParagraph:!0,isCollapsed:!0,children:[e.jsxs(l,{children:[e.jsx(r,{children:s("admin.system.searchEndpoint")}),e.jsx(d,{value:a.endpoint,onChange:n=>t({type:"update:search.endpoint",value:n.target.value}),placeholder:s("admin.system.searchPlaceholder")})]}),e.jsxs(l,{children:[e.jsxs(r,{children:[s("admin.system.searchQuery"),e.jsx(x,{className:"inline-block",content:s("admin.system.searchQueryTip")})]}),e.jsx(w,{value:a.query,onValueChange:n=>t({type:"update:search.query",value:n}),placeholder:"5",min:0,max:50})]}),e.jsx(C,{border:!0,children:s("admin.system.searchTip")}),e.jsxs(_,{children:[e.jsx("div",{className:"grow"}),e.jsx(m,{size:"sm",loading:!0,onClick:async()=>await i(),children:s("admin.system.save")})]})]})}function _e(){const{t:a}=f(),{toast:t}=E(),[i,s]=g.useReducer(H(),ce),[n,u]=g.useState(!1),h=async j=>{const p=await re(i);j!==!1&&P(t,a,p,!0)},o=async()=>{u(!0);const j=await ie();u(!1),P(t,a,j),j.status&&s({type:"set",value:j.data})};return G(o,[]),e.jsx("div",{className:"system",children:e.jsxs(J,{className:"admin-card system-card",children:[e.jsx(Q,{className:"select-none",children:e.jsx(U,{children:a("admin.settings")})}),e.jsxs(K,{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"system-actions flex flex-row",children:[e.jsx("div",{className:"grow"}),e.jsx(m,{size:"icon",variant:"outline",loading:!0,className:"mr-2",onClick:async()=>await o(),children:e.jsx(X,{className:z(n&&"animate-spin","h-4 w-4")})}),e.jsx(m,{size:"icon",loading:!0,onClick:async()=>await h(),children:e.jsx(le,{className:"h-4 w-4"})})]}),e.jsx(de,{form:i,data:i.general,dispatch:s,onChange:h}),e.jsx(ue,{form:i,data:i.site,dispatch:s,onChange:h}),e.jsx(he,{form:i,data:i.mail,dispatch:s,onChange:h}),e.jsx(pe,{form:i,data:i.search,dispatch:s,onChange:h}),e.jsx(xe,{form:i,data:i.common,dispatch:s,onChange:h})]})]})})}export{_e as default};
